# Class 6 E-R 模型

**Entity**: 现实世界中可区别于其他对象的一个“事物”或“对象”，通过**一组属性**来表示

**Relationship**: 多个实体之间的相互关联

## 实体集

相同类型即具有相同性质的实体的集合

在 E-R 图中用**矩形**表示，包含**实体集的名称**和**各个属性的名称**

## 联系集

多个实体之间的相互关联的集合

联系集是$n \ge 2$个实体集上的数学关系。如果$E_1, E_2, ...,E_n$为实体集，那么联系集$R$是$\{(e_1, e_2, ..., e_n)|e_1 \in E_1, e_2 \in  E_2, ..., e_n \in  E_n\}$

在 E-R 图中用**菱形**表示，通过线条连接到不同的实体集

参与联系集的**实体集的数目**称为联系集的**度**

## 属性

每个属性有一个可取值的集合，称为该属性的**域**，或者**值集**

几种划分类型:

- 简单和复合属性
- 单值和多值属性
- 派生属性

## 约束

### 映射基数

#### 一对一联系（1∶1）

如果对于实体集 A 中的每一个实体，实体集 B 中**至多有一个（也可以没有）**实体与之联系，**反之亦然**，则称实体集 A 与实体集 B 具有**一对一联系**，记为**1∶1**

#### 一对多联系（1∶n）

如果对于实体集 A 中的每一个实体，实体集 B 中**有 n 个实体（n≥0）**与之联系，反之，对于实体集 B 中的每一个实体，实体集 A 中**至多只有一个实体**与之联系，则称实体集 A 与实体集 B 有**一对多联系**，记为**1∶n**

#### 多对多联系（m∶n）

如果对于实体集 A 中的每一个实体，实体集 B 中**有 n 个实体（n≥0）**与之联系，反之，对于实体集 B 中的每一个实体，实体集 A 中也**有 m 个实体（m≥0）**与之联系，则称实体集 A 与实体集 B 具有**多对多联系**，记为**m∶n**

#### 两个以上的实体型之间的联系

一般地，两个以上的实体型之间也存在着**一对一**、**一对多**、**多对多**联系

#### 单个实体型内的联系

同一个实体集内的各实体之间也可以存在**一对一**、**一对多**、**多对多**的联系

### 参与约束

如果**实体集**$E$中的**每个实体**都参与到联系集$R$的至少一个联系中，实体集$E$在联系集$R$中的参与称为为**全部（total）的**

如果**实体集**$E$中的只有**部分实体**参与到$R$的联系中，实体集$E$在联系集$R$中的参与称为**部分（partial）的**

### 码

#### 实体

实体的码是一个足以**区分**每个实体的属性集

#### 联系

码同样用于唯一地标识**联系**，设$R$是一个涉及实体集$E_1,E_2, ..., E_n$为联系集

- 如果联系集$R$**没有属性**与之关联，则$primary-key(E_1)\cup primary-key(E_2)\cup ...\cup primary-key(E_n)$描述了$R$中的一个联系
- 如果联系集$R$**有属性**$a_1, a_2, ...,a_m$与之关联，则$primary-key(E_1)\cup primary-key(E_2)\cup ... \cup primary-key(E_n) \cup\{a_1, a_2, ...,a_m\}$描述了$R$中的一个联系

$primary-key(E_1)\cup primary-key(E_2) \cup ... \cup primary-key(E_n)$是联系集的**超码**

联系集的主码结构依赖于联系集的**映射基数**:

- 一对一：两个候选码任选一个
- 多对一："一"的主码作为主码
- 多对多：两个候选码组成

## 弱实体集

没有足够的属性形成**主码**的实体集称为**弱实体集**, 有**主码**的实体集称为**强实体集**

**弱实体集**必须与另一个称作**标识**或**属主实体集**的实体集关联才能有意义, 每个**弱实体**必须和一个**标识实体**相关联, 弱实体集**存在依赖**于标识实体集, 我们称标识实体集**拥有**它所标识的弱实体集

将**弱实体集**与其**标识实体集**相联的联系成为**标识性联系**

## E-R 图

E-R 图提供了表示实体型、属性和联系的方法：

- **实体型**：用**矩形**表示
  - 矩形框内写明实体名
- **联系**：用**菱形**表示
  - 用**线段**将其与相应的**实体**连接起来
  - 用**虚线**将**联系集属性**连接到联系集
  - 在菱形和矩形之间的连线上进行**标注**来表示**角色**
- **映射基数**: 将线段改为指向实体集的**箭头**表示只能联系一个
- **参与**: **双线**表示**全部参与**, **单线**表示**部分参与**
  - 在连线上标注数字$l...h$表示参与的数量限制, 数字取$*$表示无限制
- **弱实体集**: **标识性联系**的菱形边框使用**双线**

## 转换为关系模式

一个符合$E-R$图的数据库可以由一组关系模式来表示

每个**实体集**和**联系集**，都对应一个**关系模式**，该关系模式的名称是相应的实体集或联系集的名称, 每个关系模式有若干列(属性)，这些列有惟一的名称

### 转换原则

#### 实体集

一个**实体型**转换为一个**关系模式**

- 关系的属性：实体的属性
- 关系的码：实体的码

**弱实体集**还需要额外加上**标识实体集**的主码

#### 联系集

实体型间的联系有以下不同情况

- 一个$1:1$联系可以转换为一个**独立**的关系模式，也可以与任意一端对应的关系模式**合并**
  - 转换为一个**独立**的关系模式
    - 关系的属性：与该联系相连的**各实体的码**以及联系**本身的属性**
    - 关系的码：每个**实体的码**均是该关系的码
  - 与某一端实体对应的关系模式**合并**
    - 合并后关系的属性：加入对应关系的码和联系本身的属性
    - 合并后关系的码：不变
- 一个$1:n$联系可以转换为一个**独立**的关系模式，也可以与$n$**端**对应的关系模式**合并**
  - 转换为一个**独立**的关系模式
    - 关系的属性：与该联系相连的**各实体的码**以及联系**本身的属性**
    - 关系的码：$n$**端**实体的码
  - 与$n$**端**对应的关系模式**合并**
    - 合并后关系的属性：在$n$**端**关系中加入$1$**端**关系的码和联系本身的属性
    - 合并后关系的码：不变
    - _可以减少系统中的关系个数，一般情况下更倾向于采用这种方法_
- 一个$m:n$联系转换为一个关系模式
  - 关系的属性：与该联系相连的**各实体的码**以及联系**本身的属性**
  - 关系的码：各实体码的**组合**
- 三个或三个以上实体间的一个多元联系转换为一个关系模式
  - 关系的属性：与该多元联系相连的各实体的码以及联系本身的属性
  - 关系的码：各实体码的组合
- 具有相同码的关系模式可合并

#### 复杂属性

为每个子属性创建一个单独的属性

#### 多值属性

为多值属性创建新的关系模式
