# Class 2 关系

$D_{1}\times D_{2}\times\cdots\times D_{n}$的子集称为在域$D_{1},D_{2},\cdots,D_{n}$上的**关系**，记为

$$
R(D_{1},D_{2},\cdots,D{n})
$$

$R$：关系名，$n$：关系的目/度

- 当$n=1$时，称为**单元关系/一元关系**
- 当$n=2$时，称为**二元关系**

一个关系表示为**二维表**，每行是一个**元组**，每列对应一个**域**，称为**属性**

- **属性**
  - 只能在**域**中取值
  - 是**原子的**，即不可再分
  - 可以为**null**，表示未知或不存在
- **超码**：某一属性组**唯一标识**一个元组
- **候选码**：最小的**超码**
- **全码**：所有属性构成的**候选码**
- **主码**：多个**候选码**中选定的一个
- **主属性**：**候选码**包含的属性

## 关系模式

记为$R(U,D,DOM,F)$

- $R$：关系名
- $U$：属性名集合
- $D$：属性的域
- $DOM$：属性向域的映象集合
- $F$：属性间数据的依赖关系的集合

简记为$R(A_{1},A_{2},\cdots,A_{n})$，$A_{1},A_{2},\cdots,A_{n}$为属性名

## 外码

关系$R_{1}$中的一个属性$F$（非主码）包含了关系$R_{2}$的主码$K_{s}$

- $R_{1}$为外码依赖的**参照关系**
- $R_{2}$为外码的**被参照关系**
- $R_{1}$与$R_{2}$可以相同
- $F$与$K_{s}$必须定义在同一个域上
- 一个**外码**，要么为**null**，要么只能从被参照关系的主码中选值

## 关系的运算

引入记号:

- **关系模式**常记为$R$
- $t\in R$表示$t$为$R$的一个**元组**
- $t[A_{i}]$表示$t$中对应属性为$A_{i}$的**分量**
- $A=\{A_{i_{1}},A_{i_{2}},A_{i_{3}},...,A_{i_{k}}\}$为$A$的**属性列**或**属性组**,其中$A_{i_{1}},A_{i_{2}},A_{i_{3}},...,A_{i_{k}}$为$A_{1},A_{2},A_{3},...,A_{n}$的一部分
- $t[A]=(t[A_{i_{1}}],t[A_{i_{2}}],...,t[A_{i_{k}}])$表示元组$t$在属性列$A$上**分量的集合**
- $\overline{A}$表示$\{A_{1},A_{2},A_{3},...,A_{n}\}$中去掉$\{A_{i_{1}},A_{i_{2}},A_{i_{3}},...,A_{i_{k}}\}$的部分
- $t_{r}t_{s}$为**元组的连接**,为一个$n+m$列的元组
  - $R$为$n$目关系，$S$为$m$目关系
  - $t_{r}\in R,t_{s}\in S$
- **象集**$Z_{x}=\{t[Z]|t\in R(X,Z)，t[X]=x\}$

### 选择

$\sigma_{F}(R)=\{t|t\in R\wedge F(t)\}$

- 从关系$R$中选取使逻辑表达式$F$为真的元组
- $F$是一个**谓词**

### 投影

$\Pi_{A}(R) = \{ t[A] | t\in R \}$

- 从表中选出某些列
- $A$是属性组

### 集合运算

要求属性相容

- 并运算：$r\cup s=\{t|t\in r \vee t \in s\}$
- 交运算：$r \cap s = \{ t | t \in r \wedge t \in s \}$
- 差运算：$r – s  = \{t | t \in r \wedge t \notin s\}$
- 笛卡尔积：$r \times s = \{tq | t \in r \wedge q \in s\}$

### 更名运算

$\rho_{x(A_1,A_2,...,A_n)}(E)$

- 将表达式重命名为$x$, 各属性重命名为$A_1,A_2,...,A_n$

### 连接

$R\underset{A\theta B}{\bowtie}S=\{t_{r}t_{s}|t_{r}\in R \wedge t_{s}\in S \wedge t_{r}[A]\theta t_{s}[B]\}$

- 从$A$和$B$中选出特定的元组连接
- $A,B$：为$R$和$S$上度数相等且**可比**的属性组
- $\theta$：比较运算符
- **等值连接**: $\theta$为$=$的**特例**
- **自然连接**: $R\bowtie S=\{t_{r}t_{s}[U-B]|t_{r}\in R \wedge t_{s}\in S \wedge t_{r}[B]=t_{s}[B]\}$
  - 特殊的**等值连接**
  - 进行比较的分量必须是相同的属性组
  - 去掉重复的属性列
  - $R$和$S$做**自然连接**，$R$中某些元组在$S$中不存在公共属性上值相等的元组，造成$R$中这些元组被舍弃，称为**悬浮元组**
- **外连接**: 把**悬浮元组**保存在结果关系中，其他属性上填**null**，就叫做**外连接**
  - **左外连接**: 只保留左边关系$R$中的悬浮元组
  - **右外连接**: 只保留右边关系$S$中的悬浮元组
